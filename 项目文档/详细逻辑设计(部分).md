# 业务逻辑设计（详细设计）

>显式写出接口
>
>xxx.xxx格式为腾讯提供接口
>
>()内表示服务器端提供的接口
>
>相应接口在接口配置中查看
>
>这里仅给出前后端需要控制的复杂逻辑

## 复杂逻辑控制

### 1.登录逻辑

用户访问小程序-->小程序调用wx.login,处理后传给服务器端(login)-->服务器端调用auth.code2session转化唯一id并保持session,返回用户数据给前台-->完成登录

### 2.认证逻辑

用户访问小程序-->调用权限检测接口-->判断情况

情况1.用户第一次访问时通过调用scope.getUserinfo-->用户同意授权-->将用户信息传输给后台(giveUserinfo)完成保存

情况2.第二次访问时无需再进行认证

### 3.试卷状态控制

试卷状态主要通过schedule类进行控制

试卷exam主要状态有{0,1,2,3}未开始考试，预备考试，考试中，考试结束

学生copy答卷主要状态也有{0,1,2,3}预备考试，考试开始，考试结束批改完成，考试结束未批改

prepare方法：将还有15分钟开始考试的试卷取出，然后通过将其exam状态由0设置为1，同时根据exam创建相应组内成员的copy，并根据该exam试题创建copy的试题副本

begin方法：把所有达到考试时间的exam的状态由1设置为2，并将其所有的成员copy副本设置为1

end方法: 将所有达到结束时间的exam的状态由2设置为3，将所有成员copy的状态根据是否存在主观题将其状态置为2或者3

试卷状态另外一个控制方法是在批改judge当中，如果试卷所有的题目都完成批改，则将试卷状态由3变为2

### 4.成绩列表逻辑设计

成绩列表中的成绩需要返回给出卷人不同的提示，这个同样交给status{1,2,3,4}进行

分别用于标识该试卷是否进行了批改，是否进行了评价，还是这两个都无进行，抑或是已经批改完成

该逻辑在(judge/controller和judge/score通过将相应值赋值为非null),然后在成绩列表逻辑中进行二次判断
